<div *ngIf="metricsData" class="nx-margin-y-2xs">
  <sdc-compliance-bar-card [compliance]="metricsData.compliance" [showMore]="false" [hideBorder]="true"></sdc-compliance-bar-card>
  <div class="application-history nx-margin-y-2xs">
    <nx-accordion>
      <nx-expansion-panel (opened)="onOpenPanel()">
        <nx-expansion-panel-header>
          <nx-expansion-panel-title>
            <header>
              {{ 'Label.ApplicationHistory' | translate }}
              <span class="selected-date nx-margin-left-s"
                >{{ 'Label.SelectedDate' | translate }}: {{ metricsData.compliance.analysisDate | date }}</span
              >
            </header>
          </nx-expansion-panel-title>
        </nx-expansion-panel-header>
        <div class="history-component">
          <div class="application-graph nx-margin-top-2xs">
            <sdc-time-evolution-chart [config]="historicalChartConfig" [size]="{ height: 200 }"></sdc-time-evolution-chart>
          </div>
          <div class="chart-ops sdc-scrollable">
            <div
              class="sdc-op"
              [nxTooltip]="'Tooltip.ComponentMetrics' | translate : { name: metricsData.compliance.name }"
              (click)="openMetricsCards()"
            >
              <em class="fa-solid fa-align-justify"></em>
            </div>
            <div
              class="sdc-op"
              [nxTooltip]="'Tooltip.RunProcess' | translate : { name: metricsData.compliance.name }"
              (click)="onRunProcess()"
            >
              <em class="fa-solid fa-arrows-spin"></em>
            </div>
          </div>
        </div>
      </nx-expansion-panel>
    </nx-accordion>
  </div>
</div>

<div *ngIf="metricsData" class="application-coverages nx-margin-y-2xs">
  <nx-accordion>
    <nx-expansion-panel [expanded]="true">
      <nx-expansion-panel-header>
        <nx-expansion-panel-title>
          <header>
            {{ 'Label.Metrics' | translate }}
            <span class="selected-date nx-margin-left-s"
              >{{ 'Label.Coverage' | translate }}: {{ metricsData.compliance.coverage || 0 }} %</span
            >
          </header>
        </nx-expansion-panel-title>
      </nx-expansion-panel-header>
      <nx-tab-group class="tiny-tabs" [selectedIndex]="metricsData.selectedTabIndex" (selectedIndexChange)="onTabChage($event)">
        <nx-tab *ngIf="metricsData.compliance" [label]="'Label.MetricsHistoryGraphs' | translate">
          <sdc-metric-history-graphs
            [componentId]="metricsData.compliance.id"
            [selectedAnalysis]="metricsData.selectedAnalysis"
            (selectedAnalysisChange)="onMetricAnalysisSelected($event)"
          ></sdc-metric-history-graphs>
        </nx-tab>
        <nx-tab [label]="'Label.ComponentLanguageDistribution' | translate" style="display: flex">
          <ng-container *ngIf="metricsData.languageDistribution; else noData">
            <div class="language-distribution">
              <div class="historical-language-distribution">
                <sdc-time-evolution-multichart [data]="metricsData.languageDistribution"></sdc-time-evolution-multichart>
              </div>
              <div class="actual-language-distribution">
                <sdc-pie-chart
                  *ngIf="lastLanguageDistribution"
                  [data]="lastLanguageDistribution"
                  [title]="'Label.ActualLanguageDistribution' | translate"
                ></sdc-pie-chart>
              </div>
            </div>
          </ng-container>
        </nx-tab>
      </nx-tab-group>
    </nx-expansion-panel>
  </nx-accordion>
</div>

<ng-template #metricsCards let-data>
  <header nxModalTitle>
    <em class="fa-solid fa-bars nx-margin-right-s" aria-hidden="true"></em>
    {{ 'Label.ComponentMetrics' | translate : { name: data.component.name } }}
  </header>
  <div nxModalContent>
    <sdc-metrics-cards [componentId]="data.component.id"></sdc-metrics-cards>
  </div>
  <footer nxModalActions>
    <button nxButton="small secondary" type="button" (click)="closeMetricsCards()" class="nx-margin-bottom-0 nx-margin-right-xs">
      {{ 'Label.Continue' | translate }}
    </button>
  </footer>
</ng-template>

<ng-template #noData>
  <div class="nx-margin-top-m">
    <sdc-no-data></sdc-no-data>
  </div>
</ng-template>
